<launch>

  <!-- Sử dụng thời gian mô phỏng -->
  <param name="use_sim_time" value="true"/>

  <!-- Khởi chạy Gazebo -->
  <include file="$(find gazebo_ros)/launch/empty_world.launch">
	  <arg name="world_name" value="$(find mobile)/world/mapp" />
	</include>

  <!-- Load mô hình URDF vào ROS param -->
  <param name="robot_description" textfile="$(find mobile)/urdf/mobile.urdf"/>

  <!-- Spawn robot vào Gazebo -->
  <node
    name="spawn_model"
    pkg="gazebo_ros"
    type="spawn_model"
    args="-param robot_description -urdf -model mobile"
    output="screen"/>
    
  <!-- Định nghĩa vị trí ban đầu của robot -->
  <arg name="arg_x" default="0.00"/>
  <arg name="arg_y" default="0.00"/>
  <arg name="arg_z" default="0.00"/>
  <arg name="arg_R" default="0.00"/>
  <arg name="arg_P" default="0.00"/>
  <arg name="arg_Y" default="0.00"/>
  
  <!-- Giả lập quá trình hiệu chỉnh khớp -->
  <node name="fake_joint_calibration"
    pkg="rostopic" type="rostopic"
    args="pub /calibrated std_msgs/Bool true"/>

  <!-- Xuất trạng thái laser -->
  <node name="scan_publisher"
    pkg="topic_tools" type="relay"
    args="/scan"/>


  <!-- Thêm TF giữa base_link và linkphutren -->
  <node name="tf_phutren" pkg="tf" type="static_transform_publisher" args="0.17256 -0.00008 -0.016  0 0 0  base_link linkphutren 40"/>

  <!-- Thêm TF giữa linkphutren và linkphuduoi -->
  <node name="tf_phuduoi" pkg="tf" type="static_transform_publisher" args="-0.00205 -0.00974 -0.0175  0 0 0  linkphutren linkphuduoi 40"/>

  <!-- Chạy AMCL -->
  <node pkg="amcl" type="amcl" name="amcl" output="screen">
    <param name="use_map_topic" value="true"/>
    <param name="odom_frame_id" value="odom"/>
    <param name="base_frame_id" value="base_footprint"/>
    <param name="global_frame_id" value="map"/>
    <param name="laser_scan_topic" value="/scan"/>
    <param name="tf_broadcast" value="true"/>
  </node>

  <node pkg="robot_localization" type="ekf_localization_node" name="ekf_localization" output="screen">
    <param name="config" value="$(find mobile)/config/ekf.yaml"/>
  </node>


</launch>
